<!DOCTYPE html> 
<html lang='en'> 
    <head> 
        <title>WeBSR- ABSR for the Web :)</title> 
        <style type="text/css"> 
            * { 
                font-family: sans-serif; 
            } 
        </style> 
    </head> 
    <body> 
        <h1>WeBSR- ABSR for the Web :)</h1> 
        <textarea rows=20 id="area"></textarea>
        <form method="post" id="form"> 
            <!-- <input type="text" id="num" name="number" autofocus autocomplete="off">  -->
            <input type="file" id="fileinput" name="file" autocomplete="off"/>
            <script type="text/javascript">
            function readSingleFile(evt) {
                //Retrieve the first (and only!) File from the FileList object
                var f = evt.target.files[0]; 
            
                if (f) {
                var r = new FileReader();
                r.onload = function(e) { 
                    var contents = e.target.result;
                    document.getElementById('area').value =  contents;
                }
                r.readAsText(f);
            
                } else { 
                alert("Failed to load file");
                }
            }
            
            document.getElementById('fileinput').addEventListener('change', readSingleFile, false);
            </script>
            <br/><br/>
            <label for="bSubmit"> Source Material: </label>
            {% for source in sources: %}
            <button type="button" name="bSubmit" onclick="submitForm('{{ source }}')" >{{ source }}</button>
            {% endfor %}
            <button type="button" name="bSubmit" onclick="submitForm('NewFile')" >new file</button>
            <br/><br/>
            <input type="radio" id="log" name="format" value="log" onclick="formatText('log')">
            <label for="male">Log</label><br>
            <input type="radio" id="prose" name="format" value="prose" onclick="formatText('prose')">
            <label for="female">Prose</label><br>
        </form> 

        <p id="square"></p> 
        <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script> 
        <script> 
            function submitForm(submittype) {
                var number = $('#area').val(); 
                $.ajax({ 
                    url: 'http://127.0.0.1:5000/square/', 
                    data: {
                        'number': number,
                        'source': submittype,
                        'filepath': $('#fileinput').val(),
                    },
                    method: 'POST', 
                    success: function(data) { 
                        $('#fileinput').val(''); 
                        $('#square').html(data['square']) 
                    } 
                }); 
            }; 

            function formatText(format) {
                var text = document.getElementById('square').innerHTML
                $.ajax({ 
                    url: 'http://127.0.0.1:5000/format/', 
                    data: {
                        'text': text,
                        'format': format
                        },
                    method: 'POST', 
                    success: function(data) { 
                        $('#fileinput').val(''); 
                        $('#square').html(data['square']) 
                    } 
                }); 
            }; 
        </script>  
    </body> 
</html> 


